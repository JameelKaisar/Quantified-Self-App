<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{ title }} - Quantified Self</title>
        <link rel="shortcut icon" href="#">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css')}}">
    </head>
    <body>
        <div class="container">
            <p>
                Hello {{ user.username }}!
            </p>
            <p>
                <form action="" method="POST">
                    <p>
                        <label for="t_name">Tracker Name:</label>
                        <input type="text" id="t_name" name="t_name" maxlength="64" required>
                    </p>
                    <p>
                        <label for="t_desc">Tracker Description:</label>
                        <textarea rows="5" id="t_desc" name="t_desc" maxlength="256" required></textarea>
                    </p>
                    <p>
                        <div style="display: inline-block;">
                            <label for="t_type">Tracker Type:</label>
                            <select id="t_type" name="t_type" onchange="setTypeOptions(this);" required>
                                <option value="" selected hidden disabled>Choose Tracker Type</option>
                                {% for tracker_type in tracker_types %}
                                <option value="{{ tracker_type.tt_id }}">{{ tracker_type.tt_name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div id="t_unit_block" style="display: inline-block;"></div>
                    </p>
                    <input type="hidden" id="to_total" name="to_total" value="0">
                    <p id="t_options"></p>
                    <p id="t_options_control" style="display: none;">
                        <button id="t_options_add" onclick="addOption(); return false;">Add Option</button>
                        <button id="t_options_rem" onclick="remOption(); return false;" disabled>Remove Option</button>
                    </p>
                    <p>
                        <input type="reset" value="Reset" onclick="resetForm();">
                        <input type="submit" value="Add Tracker">
                    </p>
                </form>
            </p>
            <p>
                <h3><a href="/logout">Logout</a></h3>
            </p>
        </div>

        <script type="text/javascript">
            function resetForm() {
                const controller = document.getElementById("t_options_control");
                const to_total = document.getElementById("to_total");
                const t_options = document.getElementById("t_options");
                const t_unit_block = document.getElementById("t_unit_block");

                to_total.value = 0;
                while (t_unit_block.firstChild) {
                    t_unit_block.removeChild(t_unit_block.firstChild);
                }
                while (t_options.firstChild) {
                    t_options.removeChild(t_options.firstChild);
                }
                controller.style.display = "none";
            }


            function setTypeOptions(select) {
                const controller = document.getElementById("t_options_control");
                const to_total = document.getElementById("to_total");
                const t_options = document.getElementById("t_options");
                const t_unit_block = document.getElementById("t_unit_block");
                const selected = select.options[select.selectedIndex].text;

                to_total.value = 0;
                while (t_unit_block.firstChild) {
                    t_unit_block.removeChild(t_unit_block.firstChild);
                }
                while (t_options.firstChild) {
                    t_options.removeChild(t_options.firstChild);
                }

                if (selected == "Single Select" || selected == "Multi Select") {
                    controller.style.display = "block";
                    addOption();
                }
                else if (selected == "Integer" || selected == "Decimal") {
                    const label = document.createElement("label");
                    const unit = document.createElement("input");

                    label.for = "t_unit";
                    label.innerText = "Unit:";
                    unit.type = "text";
                    unit.id = "t_unit";
                    unit.name = "t_unit";
                    unit.maxLength = "16";
                    unit.required = true;
                    t_unit_block.appendChild(label);
                    t_unit_block.appendChild(unit);

                    controller.style.display = "none";
                }
                else {
                    controller.style.display = "none";
                }
            }


            function changeOptionsButton(to_total) {
                const button = document.getElementById("t_options_rem");

                if (to_total.value > 1) {
                    button.disabled = false;
                }
                else {
                    button.disabled = true;
                }
            }


            function addOption() {
                const to_total = document.getElementById("to_total");
                const t_options = document.getElementById("t_options");
                const para = document.createElement("p");
                const label = document.createElement("label");
                const option = document.createElement("input");

                label.for = "option[" + parseInt(to_total.value) + "]";
                label.innerText = "Option " + (parseInt(to_total.value)+1) + ":";
                option.type = "text";
                option.id = "t_option[" + parseInt(to_total.value) + "]";
                option.name = "t_option[" + parseInt(to_total.value) + "]";
                option.maxLength = "64";
                option.required = true;
                para.appendChild(label);
                para.appendChild(option);

                to_total.value = parseInt(to_total.value) + 1;
                changeOptionsButton(to_total);
                t_options.appendChild(para);
            }


            function remOption() {
                const to_total = document.getElementById("to_total");
                const t_options = document.getElementById("t_options");

                to_total.value = parseInt(to_total.value) - 1;
                changeOptionsButton(to_total);
                t_options.removeChild(t_options.lastChild);
            }
        </script>
        <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js')}}"></script>
    </body>
</html>
